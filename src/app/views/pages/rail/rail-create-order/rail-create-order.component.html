<div *ngIf="isLoading">
    <mat-spinner class="spinner" [diameter]="30"></mat-spinner>
</div>
<!--begin::Entry-->
<div *ngIf="!isLoading && selectedFlight != null" class="d-flex flex-column-fluid">
    <!--begin::Container-->
    <div class="container">
        <!--begin::Dashboard-->
        <!--begin::Row-->
        <div class="row">
            <div class="col-12">
                <div class="brdSmallBlock gutter-b">
                    <div class="brdSmallBlock_inner pt-4 flex-column">
                        <h2 class="text-white pl-2 opacity-70">Review your booking</h2>
                        <h6 class="text-white-50 pl-2">Booking your information</h6>
                    </div>
                </div>
            </div>
        </div>
        <!--end::Row-->
        <!--begin::Row-->
        <div class="row gutter-b">
            <div class="col-9">
                <!--begin::Details-->
                <div class="card card-custom mb-3">
                    <div class="card-body p-0">
                        <!--begin::Top-->
                        <div class="d-flex align-items-center flex-wrap p-5">
                            <div class="col-6 d-flex align-items-center flex-lg-fill pl-0">
                                <div class="symbol symbol-50 bg-gray-300 mr-4">
                                    <img (error) ="onImgError($event)" [src]="getImageName(selectedFlight.departureFlight.flightSegments[0].railID)" alt="image">
                                </div>
                                <div class="d-flex flex-column flex-wrap">
                                    <h5 class="mb-1">{{selectedFlight.departureFlight.flightSegments[0].railName}}</h5>
                                    <div class="d-flex">
                                        <span class="text-dark-50 font-weight-bold mr-2">{{selectedFlight.departureFlight.flightSegments[0].railID + selectedFlight.departureFlight.flightSegments[0].flightNumber }}</span>
                                        <span class="text-dark-50 font-weight-bold mr-2">|</span>
                                        <span class="text-dark-50 font-weight-bold"> {{ selectedFlight.departureFlight.flightSegments[0].aircraftName }} </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 d-flex align-items-center justify-content-center flex-lg-fill pl-0">
                                <div class="d-flex flex-column flex-wrap align-items-end">
                                    <h4 class="mb-1">{{ selectedFlight.departureFlight.departureTime }}</h4>
                                    <span class="text-dark-50 font-weight-bold" title="{{ selectedFlight.departureFlight.departureAirportName }}">{{ selectedFlight.departureFlight.departureAirportCode }}</span>
                                </div>
                                <div [appTooltip]="selectedFlight.departureFlight" class="d-flex flex-column flex-wrap align-items-center min-w-150px ml-3 mr-3">
                                    <div class="hr-text font-size-sm text-dark-50 mb-1">{{ selectedFlight.departureFlight.flightDuration }}</div>
                                    <div *ngIf="selectedFlight.departureFlight.isPopUp" id="popover" class="popover fade show bs-popover-bottom" style="top: 45px; left: auto;" role="tooltip" x-placement="bottom">                
                                        <div class="arrow" style="bottom: -7px; left: 45%;"></div>
                                        <div class="popover-body font-size-lg text-center">{{selectedFlight.departureFlight.popUpMessage}}</div>            
                                    </div>
                                    <span class="text-primary font-weight-bold">{{ selectedFlight.departureFlight.numberOfStops }}</span>
                                </div>
                                <div class="d-flex flex-column flex-wrap">
                                    <h4 class="mb-1">{{ selectedFlight.departureFlight.arrivalTime }}</h4>
                                    <span class="text-dark-50 font-weight-bold" title="{{ selectedFlight.departureFlight.arrivalAirportName }}">{{ selectedFlight.departureFlight.arrivalAirportCode }}</span>
                                </div>
                            </div>
                        </div>
                        <!--end::Top-->
                        <!--begin::Separator-->
                        <div class="separator separator-solid"></div>
                        <!--end::Separator-->
                    </div>
                    <div class="card-body p-0" *ngIf="selectedFlight.radioSelected == 'round'">
                        <!--begin::Top-->
                        <div class="d-flex align-items-center flex-wrap p-5">
                            <div class="col-6 d-flex align-items-center flex-lg-fill pl-0">
                                <div class="symbol symbol-50 bg-gray-300 mr-4">
                                    <img (error) ="onImgError($event)" [src]="getImageName(selectedFlight.returnFlight.flightSegments[0].railID)" alt="image">
                                </div>
                                <div class="d-flex flex-column flex-wrap">
                                    <h5 class="mb-1">{{selectedFlight.returnFlight.flightSegments[0].railName}}</h5>
                                    <div class="d-flex">
                                        <span class="text-dark-50 font-weight-bold mr-2">{{selectedFlight.returnFlight.flightSegments[0].railID + selectedFlight.returnFlight.flightSegments[0].flightNumber }}</span>
                                        <span class="text-dark-50 font-weight-bold mr-2">|</span>
                                        <span class="text-dark-50 font-weight-bold"> {{ selectedFlight.returnFlight.flightSegments[0].aircraftName }} </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6 d-flex align-items-center justify-content-center flex-lg-fill pl-0">
                                <div class="d-flex flex-column flex-wrap align-items-end">
                                    <h4 class="mb-1">{{ selectedFlight.returnFlight.departureTime }}</h4>
                                    <span class="text-dark-50 font-weight-bold" title="{{ selectedFlight.returnFlight.departureAirportName }}">{{ selectedFlight.returnFlight.departureAirportCode }}</span>
                                </div>
                                <div [appTooltip]="selectedFlight.returnFlight" class="d-flex flex-column flex-wrap align-items-center min-w-150px ml-3 mr-3">
                                    <div class="hr-text font-size-sm text-dark-50 mb-1">{{ selectedFlight.returnFlight.flightDuration }}</div>
                                    <div *ngIf="selectedFlight.returnFlight.isPopUp" id="popover2" class="popover fade show bs-popover-bottom" style="top: 45px; left: auto;" role="tooltip" x-placement="bottom">                
                                        <div class="arrow" style="bottom: -7px; left: 45%;"></div>
                                        <div class="popover-body font-size-lg text-center">{{selectedFlight.returnFlight.popUpMessage}}</div>            
                                    </div>
                                    <span class="text-primary mb-1 font-weight-bold">{{ selectedFlight.returnFlight.numberOfStops }}</span>
                                </div>
                                <div class="d-flex flex-column flex-wrap">
                                    <h4 class="mb-1">{{ selectedFlight.returnFlight.arrivalTime }}</h4>
                                    <span class="text-dark-50 font-weight-bold" title="{{ selectedFlight.returnFlight.arrivalAirportName }}">{{ selectedFlight.returnFlight.arrivalAirportCode }}</span>
                                </div>
                            </div>
                        </div>
                        <!--end::Top-->
                        <!--begin::Separator-->
                        <div class="separator separator-solid"></div>
                        <!--end::Separator-->
                    </div>
                </div>
                <!--end::Details-->
                <!-- Start::Passenger -->                
                <form [formGroup]="passengerAFG">
                    <div formArrayName="passengers" *ngFor="let passenger of passengerAFG.get('passengers')['controls']; let i = index;">
                        <div class="card card-custom mb-3" [formGroupName]="i">
                            <div class="card-header">
                                <div class="card-title">
                                    <h3 class="card-label">Passenger-{{i+1}} Details</h3>
                                </div>
                                <div class="card-toolbar">
                                    <div class="form-group mb-0">
                                        <div class="col-form-label">
                                            <div class="checkbox-inline">
                                               <mat-checkbox formControlName="WheelChair">WheelChair
                                                <span class="pl-1 text-black-50">(Add special assistance for passenger)</span>
                                               </mat-checkbox>                                                
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-4 form-group">
                                        <mat-radio-group formControlName="NameTitle" aria-label="Select an option">
                                            <mat-radio-button class="mat-primary" value="Mr">Mr</mat-radio-button>
                                            <mat-radio-button value="Mrs">Mrs</mat-radio-button>
                                            <mat-radio-button value="Miss">Miss</mat-radio-button>
                                        </mat-radio-group>
                                    </div>
                                    <div class="col-8 form-group"></div>
                                    <div class="col-4 form-group">
                                        <mat-form-field class="w-100" appearance="outline">
                                            <mat-label>First Name</mat-label>
                                            <input matInput formControlName="GivenName" required>
                                            <mat-error *ngIf="passengerFG.get('GivenName').hasError('required')">First Name is Required</mat-error>
                                        </mat-form-field>
                                    </div>
                                    <div class="col-4 form-group">
                                        <mat-form-field class="w-100" appearance="outline">
                                            <mat-label>Middle Name</mat-label>
                                            <input matInput formControlName="MiddleName" required>
                                            <mat-error *ngIf="passengerFG.get('MiddleName').hasError('required')">Middle Name is Required</mat-error>
                                        </mat-form-field>
                                    </div>
                                    <div class="col-4 form-group">
                                        <mat-form-field class="w-100" appearance="outline">
                                            <mat-label>Last Name</mat-label>
                                            <input matInput formControlName="Surname" required>
                                            <mat-error *ngIf="passengerFG.get('Surname').hasError('required')">Last Name is Required</mat-error>
                                        </mat-form-field>
                                    </div>
                                    
                                    <div class="col-4 form-group">
                                        <mat-form-field class="w-100" appearance="outline">
                                            <mat-label>Date of Birth</mat-label>
                                            <input matInput [max]="maxDate" formControlName="Birthdate" [matDatepicker]="picker" required>
                                            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                            <mat-datepicker startView="multi-year" #picker></mat-datepicker>
                                            <mat-error *ngIf="passengerFG.get('Birthdate').hasError('required')">Date of Birth is Required</mat-error>
                                        </mat-form-field>
                                    </div>
                                    <div class="col-4 form-group">
                                        <mat-form-field appearance="outline" class="w-100">
                                            <mat-label>Gender</mat-label>
                                            <mat-select formControlName="Gender" required>
                                              <mat-option *ngFor="let gen of gender" [value]="gen">
                                                {{gen}}
                                              </mat-option>
                                            </mat-select>
                                            <mat-error *ngIf="passengerFG.get('Gender').hasError('required')">Please choose a Gender</mat-error>
                                        </mat-form-field>
                                    </div>
                                    <div class="col-4 form-group">
                                        <mat-form-field appearance="outline" class="w-100">
                                            <mat-label>Country</mat-label>
                                            <mat-select formControlName="Country" required>
                                              <mat-option *ngFor="let c of countries" [value]="c">
                                                {{c}}
                                              </mat-option>
                                            </mat-select>
                                            <mat-error *ngIf="passengerFG.get('Country').hasError('required')">Please choose a Country</mat-error>
                                        </mat-form-field>
                                    </div>
                                    <div class="col-4 form-group">
                                        <mat-form-field class="w-100" appearance="outline">
                                            <mat-label>Frequent Flyer Number</mat-label>
                                            <input matInput formControlName="FrequentFlyerNumber">
                                            <mat-error *ngIf="passengerFG.get('FrequentFlyerNumber').hasError('required')">Frequent Flyer Number is Required</mat-error>
                                        </mat-form-field>
                                    </div>
                                    <div class="col-4 form-group">
                                        <mat-form-field class="w-100" appearance="outline">
                                            <mat-label>Known Traveler Number</mat-label>
                                            <input matInput formControlName="KnownTravelerNumber">
                                            <mat-error *ngIf="passengerFG.get('KnownTravelerNumber').hasError('required')">Known Traveler Number is Required</mat-error>
                                        </mat-form-field>
                                    </div>
                                    <div class="col-4 form-group">
                                        <mat-form-field class="w-100" appearance="outline">
                                            <mat-label>Redress Number</mat-label>
                                            <input matInput formControlName="RegressNumber">
                                            <mat-error *ngIf="passengerFG.get('RegressNumber').hasError('required')">Redress Number is Required</mat-error>
                                        </mat-form-field>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>                    
                </form>
                <!-- end::Passenger -->
                <!-- Start::Trip -->
                <form [formGroup]="contactFG" class="card card-custom mt-3">
                    <div class="card-header">
                        <div class="card-title">
                            <h3 class="card-label">Trip contact Details</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-4 form-group">
                                <mat-form-field class="w-100" appearance="outline">
                                    <mat-label>Primary Email</mat-label>
                                    <input matInput formControlName="EmailAddressValue" type="email" name="email" email="true" required>
                                    <mat-error *ngIf="contactFG.get('EmailAddressValue').hasError('required')">Primary Email is Required</mat-error>
                                    <mat-error *ngIf="contactFG.get('EmailAddressValue').hasError('email')">Not a Valid Email</mat-error>
                                </mat-form-field>
                            </div>
                            <div class="col-4 form-group">
                                <mat-form-field class="w-100" appearance="outline">
                                    <mat-label>Country Code</mat-label>
                                    <input matInput formControlName="AreaCode" required>
                                    <mat-error *ngIf="contactFG.get('AreaCode').hasError('required')">Country Code is Required</mat-error>
                                </mat-form-field>
                            </div>
                            <div class="col-4 form-group">
                                <mat-form-field class="w-100" appearance="outline">
                                    <mat-label>Primary phone</mat-label>
                                    <input matInput formControlName="PhoneNumber" required>
                                    <mat-error *ngIf="contactFG.get('PhoneNumber').hasError('required')">Primary phone is Required</mat-error>
                                </mat-form-field>
                            </div>                 
                        </div>
                    </div>
                </form>
                <!-- end::Trip -->
                <!-- Start::Payment -->
                <div class="card card-custom mt-3">
                    <div class="card-header">
                        <div class="card-title">
                            <h3 class="card-label">Payment Information</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-4 form-group">
                                <mat-form-field appearance="outline" class="w-100">
                                    <mat-label>Payment Type</mat-label>
                                    <mat-select [(value)]="paymentType" required>
                                      <mat-option *ngFor="let p of paymentTypes" [value]="p">
                                        {{p}}
                                      </mat-option>
                                    </mat-select>
                                    <mat-error *ngIf="passengerFG.get('Gender').hasError('required')">Please choose a Gender</mat-error>
                                </mat-form-field>
                            </div>
                            <div class="col-8 form-group"></div>
                        </div>
                        <form *ngIf="paymentType == paymentTypes[1]" [formGroup]="creditCardFG" class="row">
                            <!--<div class="col-4 form-group">
                                <mat-form-field appearance="outline">
                                    <mat-label>Credit Card Type</mat-label>
                                    <mat-select formControlName="CreditType" required>
                                      <mat-option *ngFor="let c of cardTypes" [value]="c">
                                        {{c}}
                                      </mat-option>
                                    </mat-select>
                                    <mat-error *ngIf="creditCardFG.get('CreditType').hasError('required')">Please choose Credit Card Type</mat-error>
                                </mat-form-field>
                            </div>-->
                            <div class="col-4 form-group">
                                <mat-form-field class="w-100" appearance="outline">
                                    <mat-label>Credit Card Number</mat-label>
                                    <input matInput appCreditCard formControlName="CreditCardNumber" required>
                                    <mat-error *ngIf="creditCardFG.get('CreditCardNumber').hasError('required')">Credit Card Number is Required</mat-error>
                                </mat-form-field>
                            </div>
                            <div class="col-3 form-group">
                                <mat-form-field class="w-100" appearance="outline">
                                    <mat-label>Security Code</mat-label>
                                    <input matInput appOnlyNumber formControlName="SecurityCode"  maxlength="4" required>
                                    <mat-error *ngIf="creditCardFG.get('SecurityCode').hasError('required')">Security Code is Required</mat-error>
                                </mat-form-field>
                            </div>
                            <div class="col-2 form-group">
                                <mat-form-field class="w-100" appearance="outline">
                                    <mat-label>Exp Month</mat-label>
                                    <mat-select formControlName="ExpMonth" required>
                                      <mat-option *ngFor="let m of monthArray" [disabled]="isMonthDisable(m)" [value]="m">
                                        {{m}}
                                      </mat-option>
                                    </mat-select>
                                    <mat-error *ngIf="creditCardFG.get('ExpMonth').hasError('required')">Please choose a Month</mat-error>
                                </mat-form-field>
                            </div>
                            <div class="col-3 form-group">
                                <mat-form-field appearance="outline">
                                    <mat-label>Exp Year</mat-label>
                                    <mat-select formControlName="ExpYear" required>
                                      <mat-option *ngFor="let y of yearArray" [value]="y">
                                        {{y}}
                                      </mat-option>
                                    </mat-select>
                                    <mat-error *ngIf="creditCardFG.get('ExpYear').hasError('required')">Please choose a Year</mat-error>
                                </mat-form-field>
                            </div>
                            <div class="col-6 form-group">
                                <mat-form-field class="w-100" appearance="outline">
                                    <mat-label>First Name on Card</mat-label>
                                    <input matInput formControlName="FirstNameonCard" required>
                                    <mat-error *ngIf="creditCardFG.get('FirstNameonCard').hasError('required')">First Name on Card is Required</mat-error>
                                </mat-form-field>
                            </div>
                            <div class="col-6 form-group">
                                <mat-form-field class="w-100" appearance="outline">
                                    <mat-label>Last Name on Card</mat-label>
                                    <input matInput formControlName="LastNameonCard" required>
                                    <mat-error *ngIf="creditCardFG.get('LastNameonCard').hasError('required')">Last Name on Card is Required</mat-error>
                                </mat-form-field>
                            </div>
                            <div class="col-12 form-group">
                                <mat-form-field class="w-100" appearance="outline">
                                    <mat-label>Street</mat-label>
                                    <input matInput formControlName="Street" required>
                                    <mat-error *ngIf="creditCardFG.get('Street').hasError('required')">Street is Required</mat-error>
                                </mat-form-field>
                            </div>
                            <div class="col-4 form-group">
                                <mat-form-field class="w-100" appearance="outline">
                                    <mat-label>City</mat-label>
                                    <input matInput formControlName="City" required>
                                    <mat-error *ngIf="creditCardFG.get('City').hasError('required')">City is Required</mat-error>
                                </mat-form-field>
                            </div>
                            <div class="col-4 form-group">
                                <mat-form-field class="w-100" appearance="outline">
                                    <mat-label>Postal Code</mat-label>
                                    <input matInput formControlName="PostalCode" required>
                                    <mat-error *ngIf="creditCardFG.get('PostalCode').hasError('required')">Postal Code is Required</mat-error>
                                </mat-form-field>
                            </div>
                            <div class="col-4 form-group">
                                <mat-form-field class="w-100" appearance="outline">
                                    <mat-label>Country Code</mat-label>
                                    <input matInput formControlName="CountryCode" required>
                                    <mat-error *ngIf="creditCardFG.get('CountryCode').hasError('required')">Country Code is Required</mat-error>
                                </mat-form-field>
                            </div>
                        </form>
                    </div>
                </div>
                <!-- end::Payment -->
                <!-- Start::Buttons -->
                <div class="row mt-4 align-items-end">
                    <div class="col-12 ml-lg-auto text-right">
                        <button type="button" (click)="cancel()" class="btn btn-secondary btn-lg">Cancel</button>
                        <button type="submit" (click)="bookFlight()" class="btn btn-primary btn-lg font-weight-bold ml-2">Book Flight</button>
                    </div>
                </div>
                <!-- End::Buttons -->
            </div>
            <!--Start::Price-->
            <div class="col-3 pl-0">
                <div class="card card-custom">
                    <div class="card-header">
                        <div class="card-title">
                            <h3 class="card-label">Fare Summary</h3>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="d-flex pt-3 justify-content-around">
                            <div class="col-8 font-size-lg text-left pl-6">Adult (per passenger)</div>
                            <div class="col-4 font-size-lg font-weight-bold text-right">${{ baseAmount | number : '1.2-2' }}</div>
                        </div>
                        <div class="separator separator-dashed pt-3 mb-3"></div>
                        <div class="d-flex justify-content-around">
                            <div class="col-8 font-size-lg text-left pl-6">U.S Passenger Facility Charge</div>
                            <div class="col-4 font-size-lg font-weight-bold text-right">${{ facilityCharge | number : '1.2-2' }}</div>
                        </div>
                        <div class="separator separator-dashed pt-3 mb-3"></div>
                        <div class="d-flex pb-3 justify-content-around">
                            <div class="col-8 font-size-lg text-left pl-6">Passenger Civil Aviation Security Service Fee</div>
                            <div class="col-4 font-size-lg font-weight-bold text-right">${{ securityServiceFee | number : '1.2-2' }}</div>
                        </div>
                        <div class="d-flex border-top border-2 pt-2 pb-2 justify-content-around">
                            <div class="col-7 text-left font-size-h4 pl-6">Total Amount</div>
                            <div class="col-5 text-right font-weight-bold font-size-h3">${{ fareAmount | number : '1.2-2' }}</div>
                        </div>
                    </div>
                </div>
            </div>
            <!--End::Price-->
        </div>
        <!--end::Row-->
        <!--end::Dashboard-->
    </div>
    <!--end::Container-->
</div>
<!--end::Entry-->
